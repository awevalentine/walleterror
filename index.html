<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Legitimate WalletConnect Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.05);
            text-align: center;
            max-width: 400px;
            width: 100%;
        }
        h1 { margin-bottom: 24px; color: #333; }
        .status {
            margin-top: 20px;
            padding: 12px;
            background-color: #e6f7ff;
            border-radius: 12px;
            display: none; /* Hidden by default */
        }
        p { word-break: break-all; color: #555; font-size: 14px; }
        .success-icon { font-size: 24px; margin-bottom: 8px; }
    </style>
</head>
<body>

<div class="container">
    <h1>My Legitimate DApp</h1>
    
    <w3m-button></w3m-button>

    <div id="status-area" class="status">
        <div class="success-icon">âœ…</div>
        <p><strong>Wallet Connected!</strong></p>
        <p id="wallet-address">Loading...</p>
    </div>
</div>

<script type="module">
    // 1. Import the necessary functions from the CDN
    import { createWeb3Modal, defaultConfig } from 'https://esm.sh/@web3modal/ethers@4.1.0'
    import { BrowserProvider } from 'https://esm.sh/ethers@6.10.0'

    // 2. Configuration
    const projectId = '69ae211f46b853f0ebdde4f3af8685e0' // Get your own at cloud.walletconnect.com

    const mainnet = {
        chainId: 1,
        name: 'Ethereum',
        currency: 'ETH',
        explorerUrl: 'https://etherscan.io',
        rpcUrl: 'https://cloudflare-eth.com'
    }

    const metadata = {
        name: 'My HTML DApp',
        description: 'A pure HTML/JS WalletConnect Example',
        url: 'https://my-dapp.com', 
        icons: ['https://avatars.githubusercontent.com/u/37784886']
    }

    // 3. Initialize the Modal
    const modal = createWeb3Modal({
        ethersConfig: defaultConfig({ metadata }),
        chains: [mainnet],
        projectId,
        enableAnalytics: true
    })

    // 4. Listen for Connection Events to update the UI
    const statusArea = document.getElementById('status-area')
    const addressLabel = document.getElementById('wallet-address')

    // Subscribe to state changes (Connect/Disconnect)
    modal.subscribeProvider(async ({ address, isConnected }) => {
        if (isConnected && address) {
            statusArea.style.display = 'block'
            addressLabel.textContent = address
            console.log("Safe Connection Established:", address)
        } else {
            statusArea.style.display = 'none'
            addressLabel.textContent = ''
            console.log("Disconnected")
        }
    })
</script>

</body>
</html>

